<!DOCTYPE html>
<html style="height: 100%">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>COVID-19 Time-Varying Reproduction Numbers on Global</title>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@4.8.0/dist/echarts.min.js"></script>
    <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/map/js/china.js"></script> -->
    <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/map/js/world.js"></script> -->
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.bootcss.com/twitter-bootstrap/4.4.1/css/bootstrap.min.css">
    <script src="https://cdn.bootcss.com/twitter-bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/datatables@1.10.18/media/css/jquery.dataTables.min.css">
    <script src="https://cdn.jsdelivr.net/npm/datatables@1.10.18/media/js/jquery.dataTables.min.js"></script>

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script>
    MathJax = {
        tex: {inlineMath: [['$', '$'], ['\\(', '\\)']]},
        svg: {fontCache: 'global'}
    };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>

<body>
    <div class="container">
        <h2 class='title' style='text-align: center;'>
            How many COVID-19 cases could have been prevented in the US if its 
            interventions were as effective as those in China and South Korea?
        </h2>
        <div class="row">
            <div class="col">
                <p>
                    A reproduction number $R$ is roughly how many new cases an 
                    infector will infect during the beginning and end of his/her infection. 
                    Often due to interventions and many other factors, it is a time-varying 
                    quantity. Thus, $R(t)$. Here we show this $R_{C}(t)$ for each country/region 
                    $C$ that we have collected data from various sources. 
                </p>
                <p>
                    Besides this $R_{C}(t)$, we also illustrate how many cases in country/region $C$ 
                    can be prevented if Chinese-like or South Korea-like interventions are taken at 
                    an early date $\tau$ and the interventions are assumed to be as effective in $C$ 
                    as in China or South Korea respectively. This is done by matching and replacing 
                    $R_{C}\left(t\right)$ and $R_{cn}\left(t\right)$ (or $R_{kr}\left(t\right)$ ) 
                    at time $\tau$, and using the latter for $t>\tau$. Let us call each of these two 
                    scenarios, respectively, the China model $S\left(C-cn,\tau\right)$ and the South 
                    Korea model $S\left(C-kr,\tau\right)$. We then estimate the accumulated number of 
                    cases in $C$ of those scenarios at a time $T$, which is the last date of our data 
                    that we currently have on each country $C$. We then compare those two estimated 
                    numbers against the actual accumulated number of cases in $C$, and denote it as 
                    $Pr_{C-cn}\left(T;\tau\right)=C_{C}\left(T\right)-C_{C-cn}\left(T;\tau\right)$, 
                    or $Pr_{C-kr}\left(T;\tau\right)=C_{C}\left(T\right)-C_{C-kr}\left(T;\tau\right)$ 
                    respectively. It is a function of $\tau$, which is the date of taking the China-like 
                    or South Korea-like interventions and also of $T$, which is the date that we intend 
                    to do such a comparison. When $T$ is fixed, then it is only a function of $\tau$.
                </p>
                <p>
                    For more information, please check out our manuscript at 
                    Medrxiv 10.1101/2020.05.06.20092981: 
                    <a href="https://medrxiv.org/cgi/content/short/2020.05.06.20092981v1" target="_blank">
                        How many COVID-19 cases could have been prevented in the US if its interventions 
                        were as effective as those in China and South Korea? </a>
                </p>
            </div>
        </div>

        <h3 class='title' style='text-align: center;'>
            COVID-19 Time-Varying Reproduction Numbers All Over the World</h3>
        <!-- <p style='text-align: center;'>BNU Satety and Systems Science Team (last updated on 2020/4/29)</p> -->
        <div class="row">
            <div class="col">
                <div id="chart_container_R" style="height: 560px"></div>
            </div>
        </div>
        <br>
        <h3 class='title' style='text-align: center;'>
            How many COVID-19 cases could have been prevented if the 
            interventions were as effective as those in China?</h3>
        <div class="row">
            <div class="col">
                <div id="chart_container_C1" style="height: 560px"></div>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col">
                In this table, we show the expected number of infected cases that could have been 
                prevented if on April 1st China-like interventions were taken 
                in a country/region C, and also the corresponding percentage, according to our 
                estimation. The limitations of this estimation can be found in our manuscript on 
                MedrXiv.
            </div>
        </div>
        <div class="row">
            <div class="col">
                <table id="table_C1" class="display" style="width:100%">
                    <thead>
                        <tr>
                            <th>Country</th>
                            <th>Reduced Infections</th>
                            <th>Reduced Infections (%)</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
        <br>
        <h3 class='title' style='text-align: center;'>
            How many COVID-19 cases could have been prevented if the 
            interventions were as effective as those in South Korea?</h3>
        <div class="row">
            <div class="col">
                <div id="chart_container_C2" style="height: 560px"></div>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col">
                In this table, we show the expected number of infected cases that could have been 
                prevented if on April 1st South Korea-like interventions were taken 
                in a country/region C, and also the corresponding percentage, according to our 
                estimation. The limitations of this estimation can be found in our manuscript on 
                MedrXiv.
            </div>
        </div>
        <div class="row">
            <div class="col">
                <table id="table_C2" class="display" style="width:100%">
                    <thead>
                        <tr>
                            <th>Country</th>
                            <th>Reduced Infections</th>
                            <th>Reduced Infections (%)</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
    
    <script type="text/javascript">

        $.get('./data/world_geo.json', function (worldGeoJson) {
            echarts.registerMap('world', worldGeoJson);
            var chartR = echarts.init(document.getElementById('chart_container_R'), renderer = 'svg');
            var chartC1 = echarts.init(document.getElementById('chart_container_C1'), renderer = 'svg');
            var chartC2 = echarts.init(document.getElementById('chart_container_C2'), renderer = 'svg');
            optionR = {
                baseOption: {
                    timeline: {
                        data: [],
                        axisType: 'category',
                        autoPlay: false,
                        loop: false,
                        playInterval: 1000,
                        label: {
                            color: '#999'
                        },
                        symbol: 'none',
                        lineStyle: {
                            color: '#555'
                        },
                        checkpointStyle: {
                            color: '#bbb',
                            borderColor: '#777',
                            borderWidth: 2
                        },
                        controlStyle: {
                            showNextBtn: false,
                            showPrevBtn: false,
                            color: '#666',
                            borderColor: '#666'
                        },
                        emphasis: {
                            label: {
                                color: '#fff'
                            },
                            controlStyle: {
                                color: '#aaa',
                                borderColor: '#aaa'
                            }
                        }
                    },
                    title: {
                        text: "",
                        textAlign: 'center',
                        left: '50%',
                        top: '80%',
                        textStyle: {
                            fontSize: 36,
                            color: 'rgba(255, 0, 0, 0.3)'
                        }
                    },
                    tooltip: {
                        trigger: 'item'
                    },
                    toolbox: {
                        show: true,
                        orient: 'vertical',
                        left: '5%',
                        top: 'center',
                        feature: {
                            restore: {},
                            saveAsImage: {
                                pixelRatio: 5
                            }
                        }
                    },
                    visualMap: {
                        type: "piecewise",
                        splitNumber: 5,
                        pieces: [
                            {min: 4}, // 不指定 max，表示 max 为无限大（Infinity）。
                            {min: 3.0, max: 4.0},
                            {min: 2.0, max: 3.0},
                            {min: 1.0, max: 2.0},
                            {min: 0, max: 1.0}
                        ],
                        // min: 0,
                        // max: 5,
                        // text: ['High', 'Low'],
                        realtime: true,
                        calculable: true,
                        inRange: {
                            color: ['lightgreen', 'YellowGreen', 'yellow', 'orange', 'orangered', 'darkred']
                        },
                        right: '5%',
                        top: 'center',
                    },
                    series: [{
                        name: 'Reproduction Number',
                        type: 'map',
                        map: 'world',
                        roam:  false,
                        data: []
                    }]
                },
                options: []
            };
            
            optionC1 = {
                baseOption: {
                    timeline: {
                        data: [],
                        axisType: 'category',
                        autoPlay: false,
                        loop: false,
                        playInterval: 1000,
                        label: {
                            color: '#999'
                        },
                        symbol: 'none',
                        lineStyle: {
                            color: '#555'
                        },
                        checkpointStyle: {
                            color: '#bbb',
                            borderColor: '#777',
                            borderWidth: 2
                        },
                        controlStyle: {
                            showNextBtn: false,
                            showPrevBtn: false,
                            color: '#666',
                            borderColor: '#666'
                        },
                        emphasis: {
                            label: {
                                color: '#fff'
                            },
                            controlStyle: {
                                color: '#aaa',
                                borderColor: '#aaa'
                            }
                        }
                    },
                    title: {
                        text: "",
                        textAlign: 'center',
                        left: '50%',
                        top: '80%',
                        textStyle: {
                            fontSize: 36,
                            color: 'rgba(255, 0, 0, 0.3)'
                        }
                    },
                    tooltip: {
                        trigger: 'item'
                    },
                    toolbox: {
                        show: true,
                        orient: 'vertical',
                        left: '5%',
                        top: 'center',
                        feature: {
                            restore: {},
                            saveAsImage: {
                                pixelRatio: 5
                            }
                        }
                    },
                    // visualMap: {
                    //     type: "continuous", 
                    //     min: 0,
                    //     max: 100,
                    //     // text: ['High', 'Low'],
                    //     realtime: true,
                    //     calculable: true,
                    //     inRange: {
                    //         color: ['lightgreen', 'YellowGreen', 'yellow', 'orange', 'orangered', 'darkred']
                    //     },
                    //     right: '5%',
                    //     top: 'center',
                    //     formatter: function (value) {
                    //         return value.toFixed(0) + '%';
                    //     }
                    // },
                    visualMap: {
                        type: "piecewise", 
                        splitNumber: 5,
                        pieces: [
                            {min: 1000000}, // 不指定 max，表示 max 为无限大（Infinity）。
                            {min: 100000, max: 1000000},
                            {min: 10000, max: 100000},
                            {min: 1000, max: 10000},
                            {min: 0, max: 1000}
                        ],
                        realtime: true,
                        calculable: true,
                        inRange: {
                            color: ['lightgreen', 'YellowGreen', 'yellow', 'orange', 'orangered', 'darkred']
                        },
                        right: '5%',
                        top: 'center'
                    },
                    series: [{
                        name: 'Reduced infections ',
                        type: 'map',
                        map: 'world',
                        roam:  false,
                        data: []
                    }]
                },
                options: []
            };
            
            optionC2 = {
                baseOption: {
                    timeline: {
                        data: [],
                        axisType: 'category',
                        autoPlay: false,
                        loop: false,
                        playInterval: 1000,
                        label: {
                            color: '#999'
                        },
                        symbol: 'none',
                        lineStyle: {
                            color: '#555'
                        },
                        checkpointStyle: {
                            color: '#bbb',
                            borderColor: '#777',
                            borderWidth: 2
                        },
                        controlStyle: {
                            showNextBtn: false,
                            showPrevBtn: false,
                            color: '#666',
                            borderColor: '#666'
                        },
                        emphasis: {
                            label: {
                                color: '#fff'
                            },
                            controlStyle: {
                                color: '#aaa',
                                borderColor: '#aaa'
                            }
                        }
                    },
                    title: {
                        text: "",
                        textAlign: 'center',
                        left: '50%',
                        top: '80%',
                        textStyle: {
                            fontSize: 36,
                            color: 'rgba(255, 0, 0, 0.3)'
                        }
                    },
                    tooltip: {
                        trigger: 'item'
                    },
                    toolbox: {
                        show: true,
                        orient: 'vertical',
                        left: '5%',
                        top: 'center',
                        feature: {
                            restore: {},
                            saveAsImage: {
                                pixelRatio: 5
                            }
                        }
                    },
                    // visualMap: {
                    //     type: "continuous", 
                    //     min: 0,
                    //     max: 100,
                    //     // text: ['High', 'Low'],
                    //     realtime: true,
                    //     calculable: true,
                    //     inRange: {
                    //         color: ['lightgreen', 'YellowGreen', 'yellow', 'orange', 'orangered', 'darkred']
                    //     },
                    //     right: '5%',
                    //     top: 'center',
                    //     formatter: function (value) {
                    //         return value.toFixed(0) + '%';
                    //     }
                    // },
                    visualMap: {
                        type: "piecewise", 
                        splitNumber: 5,
                        pieces: [
                            {min: 1000000}, // 不指定 max，表示 max 为无限大（Infinity）。
                            {min: 100000, max: 1000000},
                            {min: 10000, max: 100000},
                            {min: 1000, max: 10000},
                            {min: 0, max: 1000}
                        ],
                        realtime: true,
                        calculable: true,
                        inRange: {
                            color: ['lightgreen', 'YellowGreen', 'yellow', 'orange', 'orangered', 'darkred']
                        },
                        right: '5%',
                        top: 'center'
                    },
                    series: [{
                        name: 'Reduced infections ',
                        type: 'map',
                        map: 'world',
                        roam:  false,
                        data: []
                    }]
                },
                options: []
            };

            $.get('./data/world_R.json', function (worldJson) {
                for (var i = 0; i < worldJson.dates.length; i++) {
                    optionR.baseOption.timeline.data.push(worldJson.dates[i]);
                    optionR.options.push(
                        {
                            title: {
                                text: worldJson.dates[i]
                            },
                            series: [{
                                name: 'Reproduction Number',
                                type: 'map',
                                map: 'world',
                                roam:  false,
                                data: worldJson.data[i]
                            }]
                        },
                    );
                }
                chartR.setOption(optionR);
                chartR.on('click', function (params) {
                    if (params.data) {
                         window.open('./region.html?country=' + params.data.name);
                    }
                });

                chartR.on('timelinechanged', function (params) {
                    // console.log(worldJson.dates[params.currentIndex]);
                    // var chartTitle = 'R_' + worldJson.dates[params.currentIndex];
                    // saveChart('chart_container_R', chartTitle)
                });
            });

            $.get('./data/world_reducedcases_scenario_China.json', function (worldJson) {
                for (var i = 0; i < worldJson.dates.length; i++) {
                    optionC1.baseOption.timeline.data.push(worldJson.dates[i]);
                    optionC1.options.push(
                        {
                            title: {
                                text: worldJson.dates[i]
                            },
                            series: [{
                                name: 'Reduced infections',
                                type: 'map',
                                map: 'world',
                                roam:  false,
                                data: worldJson.data[i]
                            }]
                        },
                    );
                }
                chartC1.setOption(optionC1);
                chartC1.on('click', function (params) {
                    if (params.data) {
                         window.open('./region.html?country=' + params.data.name);
                    }
                });

                chartC1.on('timelinechanged', function (params) {
                    // console.log(worldJson.dates[params.currentIndex]);
                    // var chartTitle = 'C1_' + worldJson.dates[params.currentIndex]; 
                    // saveChart('chart_container_C1', chartTitle)
                });
            });

            $.get('./data/world_reducedcases_scenario_Korea.json', function (worldJson) {
                for (var i = 0; i < worldJson.dates.length; i++) {
                    optionC2.baseOption.timeline.data.push(worldJson.dates[i]);
                    optionC2.options.push(
                        {
                            title: {
                                text: worldJson.dates[i]
                            },
                            series: [{
                                name: 'Reduced infections',
                                type: 'map',
                                map: 'world',
                                roam:  false,
                                data: worldJson.data[i]
                            }]
                        },
                    );
                }
                chartC2.setOption(optionC2);
                chartC2.on('click', function (params) {
                    if (params.data) {
                         window.open('./region.html?country=' + params.data.name);
                    }
                });

                chartC2.on('timelinechanged', function (params) {
                    // console.log(worldJson.dates[params.currentIndex]);
                    // var chartTitle = 'C2_' + worldJson.dates[params.currentIndex]; 
                    // saveChart('chart_container_C2', chartTitle)
                });
            });
        });

        function saveChart(chartId, chartTitle) {
            var chart = echarts.getInstanceByDom(document.getElementById(chartId));
            var url = chart.getConnectedDataURL({
                pixelRatio: 5,
                backgroundColor: '#fff',
                excludeComponents: ['toolbox', 'timeline'],
                type: 'png'
            });
            var $a = document.createElement('a');
            var type = 'png';
            $a.download = chartTitle + '.' + type;
            $a.target = '_blank';
            $a.href = url;
            var evt = new MouseEvent('click', {
                view: window,
                bubbles: true,
                cancelable: false
            });
            $a.dispatchEvent(evt);
        }


        $(document).ready(function() {
            $('#table_C1').DataTable( {
                "ajax": "./data/scenario_China_reducedcases_2020-04-01.json",
                "columns": [
                    { "data": "Country" },
                    { "data": "Reduced Infections" },
                    { "data": "Reduced Infections (%)" }
                ],
                "lengthChange": false,
                "searching": false,
                "ordering": false
            } );

            $('#table_C2').DataTable( {
                "ajax": "./data/scenario_Korea_reducedcases_2020-04-01.json",
                "columns": [
                    { "data": "Country" },
                    { "data": "Reduced Infections" },
                    { "data": "Reduced Infections (%)" }
                ],
                "lengthChange": false,
                "searching": false,
                "ordering": false
            } );
        } );
    </script>
</body>

</html>